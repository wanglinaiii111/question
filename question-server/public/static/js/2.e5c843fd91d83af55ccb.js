(window.webpackJsonp=window.webpackJsonp||[]).push([[2,8,12],{"/+HT":function(e,t,a){"use strict";a("I1WT")},"29BC":function(e,t,a){"use strict";a("Zkx9")},Ar7e:function(e,t,a){"use strict";a.r(t);var s=a("QbLZ"),i=a.n(s),l=a("aHvB"),r=a("jb8k"),o={name:"exam-ques-list",props:["param"],data:function(){var e=this;return{tableData:[],dialogFormVisible:!1,form:{t_number:1,points:[],scores:0},resolve:null,props:{lazy:!0,checkStrictly:!0,lazyLoad:function(t,a){if(e.resolve=a,0===t.level)e.getKnowledgeNode(0);else{if(0===t.data.is_have_childe)return;e.getKnowledgeNode(t.data.tree_id)}}}}},mounted:function(){this.getList()},methods:{getList:function(){var e=this;this.$request.fetchExamQuesSelect({exam_detail_id:this.param.exam_detail_id}).then((function(t){e.tableData=t.data})).catch((function(e){console.log(e)}))},getKnowledgeNode:function(e){var t=this;this.$request.fetchKnowledgeNode({parentid:e,subjectid:this.param.subject_id}).then((function(e){var a=e.data.map((function(e){return{value:e.name,tree_id:e.tree_id,label:e.name,leaf:0===e.is_have_childe}}));t.resolve(a)})).catch((function(e){console.log(e)}))},changePoint:function(e){this.form.points=e},confirm:function(){var e=this;this.dialogFormVisible=!1,this.$request.fetchExamQuesInsert({exam_detail_id:this.param.exam_detail_id,dataList:[{t_number:this.form.t_number,points:this.form.points.join(";"),scores:this.form.scores}]}).then((function(t){t.data.desc&&e.$message.error("添加失败"),e.getList(),e.$message.error("添加成功")}))},handleDelete:function(e){var t=this;this.$request.fetchExamQuesDelete({id:e.id}).then((function(e){e.data.desc&&t.$message.error("删除失败"),t.getList(),t.$message.error("删除成功")}))},back:function(){this.$store.dispatch("setExamLevel","subject")}}},n=(a("29BC"),a("KHd+")),c=Object(n.a)(o,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-button",{staticClass:"back",attrs:{size:"medium"},on:{click:e.back}},[e._v("返回上一级")]),e._v(" "),a("el-button",{staticClass:"addBtn",attrs:{size:"medium"},on:{click:function(t){e.dialogFormVisible=!0}}},[e._v("添加试题")]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{prop:"t_number",label:"题号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"points",label:"知识点"}}),e._v(" "),a("el-table-column",{attrs:{prop:"scores",label:"分数"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popconfirm",{attrs:{title:"确定删除这条记录吗？"},on:{confirm:function(a){return e.handleDelete(t.row)}}},[a("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[e._v("删除")])],1)]}}])})],1),e._v(" "),a("el-dialog",{attrs:{title:"添加试题",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{attrs:{model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"题号"}},[a("el-input",{model:{value:e.form.t_number,callback:function(t){e.$set(e.form,"t_number",t)},expression:"form.t_number"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"知识点"}},[a("el-cascader",{key:e.form.subject_id,attrs:{props:e.props,"show-all-levels":!0,size:"medium"},on:{change:e.changePoint},model:{value:e.form.points,callback:function(t){e.$set(e.form,"points",t)},expression:"form.points"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"分数"}},[a("el-input",{model:{value:e.form.scores,callback:function(t){e.$set(e.form,"scores",t)},expression:"form.scores"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,"b6703c22",null).exports,u={name:"student",components:{SubjectList:l.default,ClassReport:r.default,ExamQuesList:c},data:function(){return{dialogVisible:!1,dialogSubVisible:!1,ruleForm:{name:"",start_time:"",end_time:""},formAddSub:{subject_id:"1",question_file_path:"",answer_file_path:""},tableData:[],allSubjectList:[],curRow:{},gradeParam:{}}},mounted:function(){this.getList(),this.getSubjectList()},beforeRouteLeave:function(e,t,a){this.$store.dispatch("setExamLevel","exam"),a()},methods:{getList:function(){var e=this;this.$request.fetchSelectExam({}).then((function(t){e.tableData=t.data.result})).catch((function(e){console.log(e)}))},getSubjectList:function(){var e=this;this.$request.fetchSelectSubject({}).then((function(t){e.allSubjectList=t.data})).catch((function(e){console.log(e)}))},create:function(){var e=this;this.$request.fetchCreateExam({name:this.ruleForm.name,start_time:this.ruleForm.start_time,end_time:this.ruleForm.end_time}).then((function(t){if(t.data.result)return e.dialogVisible=!1,e.getList(),void e.$message({showClose:!0,message:"创建成功！",type:"success"});t.data.desc&&e.$message({showClose:!0,message:t.data.desc,type:"error"})})).catch((function(e){console.log(e)}))},delete:function(e){var t=this;this.$request.fetchDelExam({exam_id:e}).then((function(e){t.getList(),t.$message({showClose:!0,message:"删除成功！",type:"success"})})).catch((function(e){console.log(e)}))},handleDelete:function(e){this.delete(e.exam_id)},createSubject:function(e){this.dialogSubVisible=!0,this.formAddSub=i()({},this.formAddSub,{exam_id:e.exam_id})},showSubject:function(e){this.curRow={exam_id:e.exam_id,exam_name:e.name},this.$store.dispatch("setExamLevel","subject")},handleExceed:function(e){this.$message.warning("您已上传"+e+"，请将已上传的文件删除后重新上传")},changeSubject:function(){this.fileList=[],this.answersFileList=[]},getMsg:function(e){this.gradeParam=e},getGradeMsg:function(e){this.curRow=e}}},d=(a("jhZ4"),Object(n.a)(u,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",["exam"===e.$store.getters.examLevel?["ordinary"!==e.$store.getters.info.role?a("el-button",{staticClass:"addBtn",attrs:{size:"medium"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("创建考试")]):e._e(),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{prop:"name",label:"考试名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"start_time",label:"开始时间",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{prop:"end_time",label:"结束时间",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.showSubject(t.row)}}},[e._v("查看科目")]),e._v(" "),"ordinary"!==e.$store.getters.info.role?a("el-popconfirm",{attrs:{title:"确定删除这次考试吗？"},on:{confirm:function(a){return e.handleDelete(t.row)}}},[a("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[e._v("删除")])],1):e._e()]}}],null,!1,444756042)})],1),e._v(" "),a("el-dialog",{attrs:{title:"创建考试",visible:e.dialogVisible,width:"337px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{attrs:{model:e.ruleForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"考试名称"}},[a("el-input",{model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"开始时间"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择开始时间","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.ruleForm.start_time,callback:function(t){e.$set(e.ruleForm,"start_time",t)},expression:"ruleForm.start_time"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"结束时间"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择结束时间","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.ruleForm.end_time,callback:function(t){e.$set(e.ruleForm,"end_time",t)},expression:"ruleForm.end_time"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.create}},[e._v("确 定")])],1)],1)]:"subject"===e.$store.getters.examLevel?a("SubjectList",{attrs:{param:e.curRow},on:{func:e.getMsg}}):"grade"===e.$store.getters.examLevel?a("ClassReport",{attrs:{param:e.gradeParam},on:{func:e.getGradeMsg}}):"quesList"===e.$store.getters.examLevel?a("ExamQuesList",{attrs:{param:e.gradeParam},on:{func:e.getGradeMsg}}):e._e()],2)}),[],!1,null,"77a5da28",null));t.default=d.exports},DrTt:function(e,t,a){},EXgF:function(e,t,a){"use strict";a("d+T5")},I1WT:function(e,t,a){},Zkx9:function(e,t,a){},aHvB:function(e,t,a){"use strict";a.r(t);var s=a("QbLZ"),i=a.n(s),l={name:"subject",props:["param"],data:function(){return{dialogSubVisible:!1,formAddSub:{subject_id:"1",question_file_path:"",answer_file_path:""},allSubjectList:[],curSubjectList:[],exam_id:"",exam_name:"",fileList:[],answersFileList:[],fileName:"",answersFileName:""}},mounted:function(){this.exam_id=this.param.exam_id||"",this.exam_name=this.param.exam_name||"",this.getList(),this.getSubjectList()},methods:{upload:function(e,t){var a=this,s=e.file.name.split(".").pop(),i=this.formAddSub.exam_id+"_"+this.formAddSub.subject_id+"_"+t+"."+s;"questions"===t?this.fileName=i:"answers"===t?this.answersFileName=i:this.gradeFileName=i;var l=new FormData;l.append("files",e.file),l.append("filename",i),console.log(l),this.$request.fetchExamUpload(l).then((function(e){e.IsSuccess&&a.imgList.push(e.Data.Data)}))},getList:function(){var e=this;this.$request.fetchSelectExamsubject({exam_id:this.exam_id}).then((function(t){e.curSubjectList=t.data})).catch((function(e){console.log(e)}))},getSubjectList:function(){var e=this;this.$request.fetchSelectSubject({}).then((function(t){e.allSubjectList=t.data})).catch((function(e){console.log(e)}))},createSubject:function(){this.dialogSubVisible=!0,this.fileList=[],this.answersFileList=[],this.formAddSub=i()({},this.formAddSub,{exam_id:this.exam_id})},submitAddSubject:function(){var e=this;this.fileName?this.answersFileName?this.$request.fetchCreateExamsubject(i()({},this.formAddSub,{question_file_path:this.fileName,answer_file_path:this.answersFileName})).then((function(t){if(t.data.result)return e.dialogSubVisible=!1,e.getList(),void e.$message({showClose:!0,message:"上传成功！",type:"success"});t.data.desc&&e.$message({showClose:!0,message:t.data.desc,type:"error"})})).catch((function(e){console.log(e)})):this.$message.error("答案未上传，请上传答案"):this.$message.error("试卷未上传，请上传试卷")},showReport:function(e){this.$emit("func",{exam_detail_id:e.exam_detail_id,subject_name:e.subject_name,exam_name:this.exam_name,exam_id:e.exam_id,subject_id:e.subject_id}),this.$store.dispatch("setExamLevel","grade")},handleExceed:function(e){this.$message.warning("您已上传"+e+"，请将已上传的文件删除后重新上传")},changeSubject:function(){this.fileList=[],this.answersFileList=[]},back:function(){this.$store.dispatch("setExamLevel","exam")},showQues:function(e){this.$emit("func",{exam_detail_id:e.exam_detail_id,subject_name:e.subject_name,exam_name:this.exam_name,exam_id:e.exam_id,subject_id:e.subject_id}),this.$store.dispatch("setExamLevel","quesList")}}},r=(a("/+HT"),a("KHd+")),o=Object(r.a)(l,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[[a("el-button",{staticClass:"back",attrs:{size:"medium"},on:{click:e.back}},[e._v("返回上一级")]),e._v(" "),"ordinary"!==e.$store.getters.info.role?a("el-button",{staticClass:"addBtn",attrs:{size:"medium"},on:{click:e.createSubject}},[e._v("添加科目")]):e._e(),e._v(" "),a("div",{staticClass:"card"},[a("h1",[e._v(e._s(e.exam_name))])]),e._v(" "),a("el-table",{attrs:{data:e.curSubjectList}},[a("el-table-column",{attrs:{property:"subject_name",label:"科目名称"}}),e._v(" "),a("el-table-column",{attrs:{property:"question_file_path",label:"试卷文件名"}}),e._v(" "),a("el-table-column",{attrs:{property:"answer_file_path",label:"答案文件名"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.showReport(t.row)}}},[e._v("查看各班级成绩单")]),e._v(" "),a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.showQues(t.row)}}},[e._v("查看试题")])]}}])})],1)],e._v(" "),a("el-dialog",{attrs:{title:"添加科目",visible:e.dialogSubVisible,width:"357px"},on:{"update:visible":function(t){e.dialogSubVisible=t}}},[a("el-form",{attrs:{model:e.formAddSub,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"考试科目"}},[a("el-select",{attrs:{size:"medium",placeholder:"请选择考试科目",filterable:""},on:{change:e.changeSubject},model:{value:e.formAddSub.subject_id,callback:function(t){e.$set(e.formAddSub,"subject_id",t)},expression:"formAddSub.subject_id"}},e._l(e.allSubjectList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"上传试卷"}},[a("el-upload",{attrs:{action:"","with-credentials":!0,limit:1,"file-list":e.fileList,"http-request":function(t){return e.upload(t,"questions")},"on-exceed":function(){return e.handleExceed("试卷")}}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"上传答案"}},[a("el-upload",{attrs:{action:"","with-credentials":!0,limit:1,"file-list":e.answersFileList,"http-request":function(t){return e.upload(t,"answers")},"on-exceed":function(){return e.handleExceed("答案")}}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogSubVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.submitAddSubject}},[e._v("确 定")])],1)],1)],2)}),[],!1,null,"47df7353",null);t.default=o.exports},"d+T5":function(e,t,a){},jb8k:function(e,t,a){"use strict";a.r(t);var s={name:"student",props:["param"],data:function(){return{dialogGrade:!1,tableData:[],exam_detail_id:"",subject_name:"",exam_name:"",exam_id:"",subject_id:"",gradeFileList:[],gradeFileName:"",gradeForm:{class:""},options:[],classMap:{}}},mounted:function(){this.subject_name=this.param.subject_name||"",this.exam_name=this.param.exam_name||"",this.exam_detail_id=this.param.exam_detail_id||"",this.exam_id=this.param.exam_id||"",this.subject_id=this.param.subject_id||"",this.getList(),this.getClassList()},methods:{getList:function(){var e=this;this.$request.fetchSelectGradereport({exam_detail_id:this.exam_detail_id}).then((function(t){e.tableData=t.data})).catch((function(e){console.log(e)}))},upload:function(e,t){var a=this;if(this.gradeForm.class){var s=this.classMap[this.gradeForm.class].level,i=this.classMap[this.gradeForm.class].cno,l=e.file.name.split(".").pop(),r=this.exam_id+"_"+this.subject_id+"_"+s+"_"+i+"_"+t+"."+l;this.gradeFileName=r;var o=new FormData;o.append("files",e.file),o.append("filename",r),this.$request.fetchExamUpload(o).then((function(e){e.IsSuccess&&a.imgList.push(e.Data.Data)}))}else this.$message.error("请先选择班级")},getClassList:function(){var e=this;this.$request.fetchSearchClass({level:"",headteacher:""}).then((function(t){for(var a=t.data.result,s=[],i=function(t){var i=a[t];e.classMap[a[t].id]=a[t];var l=s.find((function(e){return e.value===i.level}));l||(l={value:i.level,label:i.level,children:[]},s.push(l)),l.children.push({value:i.id,label:i.cno})},l=0;l<a.length;l++)i(l);e.options=s})).catch((function(t){console.log(t),e.$message({showClose:!0,message:"班级列表数据获取失败！",type:"error"})}))},submitGradeForm:function(){var e=this;this.gradeFileName?this.$request.fetchCreateGradereport({exam_id:this.exam_id,exam_detail_id:this.exam_detail_id,class_id:this.gradeForm.class,grade_file_path:this.gradeFileName}).then((function(t){if(t.data.result)return e.dialogGrade=!1,e.getList(),void e.$message({showClose:!0,message:"上传成功！",type:"success"});t.data.desc&&e.$message({showClose:!0,message:t.data.desc,type:"error"})})).catch((function(e){console.log(e)})):this.$message.error("成绩单未上传，请上传成绩单")},deleteRow:function(e){var t=this;this.$request.fetchDelGradereport({class_grade_report_id:e.class_grade_report_id}).then((function(e){if(e.data.result)return t.getList(),void t.$message.success("删除成功");e.data.desc&&t.$message.error(e.data.desc)}))},clickUpload:function(){this.dialogGrade=!0,this.gradeForm.class="",this.gradeFileList=[]},handleExceed:function(e){this.$message.warning("您已上传"+e+"，请将已上传的文件删除后重新上传")},handleChange:function(e){this.gradeForm.class=e[1]},back:function(){this.$emit("func",{exam_name:this.param.exam_name,exam_id:this.param.exam_id}),this.$store.dispatch("setExamLevel","subject")}}},i=(a("EXgF"),a("KHd+")),l=Object(i.a)(s,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-button",{staticClass:"back",attrs:{size:"medium"},on:{click:e.back}},[e._v("返回上一级")]),e._v(" "),"ordinary"!==e.$store.getters.info.role?a("el-button",{staticClass:"addBtn",attrs:{size:"medium"},on:{click:e.clickUpload}},[e._v("上传成绩单")]):e._e(),e._v(" "),[a("div",{staticClass:"card"},[a("h1",[e._v(e._s(e.exam_name)+"-"+e._s(e.subject_name)+" 成绩单")])]),e._v(" "),a("el-table",{attrs:{data:e.tableData}},[a("el-table-column",{attrs:{property:"level",label:"年级"}}),e._v(" "),a("el-table-column",{attrs:{property:"cno",label:"班级"}}),e._v(" "),a("el-table-column",{attrs:{property:"header_teacher_name",label:"班主任"}}),e._v(" "),a("el-table-column",{attrs:{property:"grade_file_path",label:"成绩单"}}),e._v(" "),"ordinary"!==e.$store.getters.info.role?a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popconfirm",{attrs:{title:"确定删除这个成绩单吗？"},on:{confirm:function(a){return e.deleteRow(t.row)}}},[a("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[e._v("删除")])],1)]}}],null,!1,2346253812)}):e._e()],1)],e._v(" "),a("el-dialog",{attrs:{title:"上传成绩单",visible:e.dialogGrade,width:"347px"},on:{"update:visible":function(t){e.dialogGrade=t}}},[a("el-form",{attrs:{model:e.gradeForm,"label-width":"90px"}},[a("el-form-item",{attrs:{label:"班级"}},[a("el-cascader",{attrs:{options:e.options},on:{change:e.handleChange},model:{value:e.gradeForm.class,callback:function(t){e.$set(e.gradeForm,"class",t)},expression:"gradeForm.class"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"上传成绩单"}},[a("el-upload",{attrs:{action:"","with-credentials":!0,limit:1,"file-list":e.gradeFileList,"http-request":function(t){return e.upload(t,"grade")},"on-exceed":function(){return e.handleExceed("成绩单")}}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("上传成绩单")])],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogAddStu=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitGradeForm()}}},[e._v("确 定")])],1)],1)],2)}),[],!1,null,"b11fd8a8",null);t.default=l.exports},jhZ4:function(e,t,a){"use strict";a("DrTt")}}]);
//# sourceMappingURL=2.e5c843fd91d83af55ccb.js.map