(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"bGw+":function(e,t,a){},bsrR:function(e,t,a){"use strict";a.r(t);var l={name:"group-table",props:["studentMap"],data:function(){return{stuMap:{},tableData:[{grade:"2019",class:"1班",classGroup:[{groupId:1,rank:"王者",weakKnowledgeInfo:[{weakKnowledge:"重力",rate:.75},{weakKnowledge:"牛顿第一定律",rate:.75}],student:["101","102","103"]},{groupId:2,rank:"黄金",weakKnowledgeInfo:[{weakKnowledge:"功",rate:.5},{weakKnowledge:"万有引力定律",rate:.4},{weakKnowledge:"动能定理",rate:.3},{weakKnowledge:"磁场",rate:.6}],student:["104","105","106"]}]},{grade:"2019",class:"2班",classGroup:[{groupId:1,rank:"白金",weakKnowledgeInfo:[{weakKnowledge:"重力",rate:.5},{weakKnowledge:"牛顿第一定律",rate:.4},{weakKnowledge:"磁场",rate:.6}],student:["201","202","203"]},{groupId:2,rank:"白金",weakKnowledgeInfo:[{weakKnowledge:"功",rate:.5},{weakKnowledge:"万有引力定律",rate:.4},{weakKnowledge:"动能定理",rate:.3}],student:["204","205","206"]}]}]}},watch:{studentMap:function(e,t){this.stuMap=e}},mounted:function(){},methods:{getTableData:function(e){var t=this;return e.map((function(e){return{sno:e,sname:t.stuMap[e]?t.stuMap[e].sname:""}}))},getKnowledgeInfo:function(e){for(var t="",a=0;a<e.length;a++)t+=e[a].weakKnowledge+"_"+e[a].rate,a!=e.length-1&&(t+="||");return t}}},n=(a("en8D"),a("KHd+")),o={name:"addgroup",components:{GroupTable:Object(n.a)(l,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",e._l(e.tableData,(function(t){return a("div",{key:t.grade+t.class,staticClass:"groupTable"},[a("h1",[e._v("年级："+e._s(t.grade)+" 班级："+e._s(t.class))]),e._v(" "),a("el-table",{staticStyle:{width:"100%","margin-top":"8px"},attrs:{data:t.classGroup}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.getTableData(t.row.student),border:""}},[a("el-table-column",{attrs:{prop:"sname",label:"学生姓名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"sno",label:"学号"}})],1)]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{prop:"groupId",label:"组号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"rank",label:"所属分级"}}),e._v(" "),a("el-table-column",{attrs:{label:"薄弱知识点信息"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("\n            "+e._s(e.getKnowledgeInfo(t.row.weakKnowledgeInfo))+"\n            ")])]}}],null,!0)})],1)],1)})),0)}),[],!1,null,"113b75ac",null).exports},data:function(){return{form:{exam:"",examSub:"",level:(new Date).getFullYear()+""},dialogTableVisible:!1,examList:[],examsubjectList:[],classList:[],no_upload_grade_cno:[],studentMap:{},isGetGroup:!1}},mounted:function(){this.getExamList(),this.getClassList()},methods:{getExamList:function(){var e=this;this.$request.fetchSelectExam({}).then((function(t){if(e.examList=t.data.result,t.data.result.length>0){var a=t.data.result[0].exam_id;e.getExamSubList(a),e.form.exam=a}})).catch((function(e){console.log(e)}))},getExamSubList:function(e){var t=this;this.$request.fetchSelectExamsubject({exam_id:e}).then((function(e){if(t.examsubjectList=e.data,e.data.length>0){var a=e.data[0].subject_id;t.form.examSub=a}})).catch((function(e){console.log(e)}))},getClassList:function(){var e=this;this.$request.fetchSearchClass({level:this.form.level,headteacher:""}).then((function(t){e.classList=t.data.result}))},checkGrade:function(){var e=this;this.getStudentList(),this.$request.fetchCheckreport({grade_file_name_list:this.getGrade()}).then((function(t){var a=t.data.no_upload_grade_cno;if(a.length>0)return e.dialogTableVisible=!0,void(e.no_upload_grade_cno=a.map((function(e){return{cno:e,level:t.data.level}})));e.clevelreport(),e.getGroup()}))},clevelreport:function(){var e=this;if(0===this.getGrade().length)return this.$message.error("当前年级下面没有班级");this.$request.fetchClevelreport({grade_file_name_list:this.getGrade(),examid:this.form.exam,subjectid:this.form.examSub}).then((function(t){"合并失败!"===t.data.desc&&e.$message.error(t.data.desc),e.isGetGroup=!0}))},getGroup:function(){this.$request.fetchGetgroup({examName:"期末考试"}).then((function(e){}))},getGrade:function(){var e=this;return this.classList.map((function(t){return e.form.exam+"_"+e.form.examSub+"_"+e.form.level+"_"+t.cno+"_grade.xlsx"}))},getStudentList:function(){var e=this;this.$request.fetchSearchStu({level:this.form.level,cno:""}).then((function(t){for(var a=t.data.result,l={},n=0;n<a.length;n++)l[a[n].sno]=a[n];e.studentMap=l,console.log(l)})).catch((function(e){console.log(e)}))},confirm:function(){this.dialogTableVisible=!1,this.clevelreport()},changeLevel:function(e){this.form.level=e,this.getClassList()},changeExam:function(e){this.form.exam=e,this.getExamSubList(e)}}},r=(a("xqZR"),Object(n.a)(o,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"card"},[a("el-form",{ref:"form",staticClass:"myForm",attrs:{model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"考试名称",size:"medium"}},[a("el-select",{model:{value:e.form.exam,callback:function(t){e.$set(e.form,"exam",t)},expression:"form.exam"}},e._l(e.examList,(function(t){return a("el-option",{key:t.exam_id,attrs:{label:t.name,value:t.exam_id},on:{change:e.changeExam}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"科目名称",size:"medium"}},[a("el-select",{model:{value:e.form.examSub,callback:function(t){e.$set(e.form,"examSub",t)},expression:"form.examSub"}},e._l(e.examsubjectList,(function(e){return a("el-option",{key:e.subject_id,attrs:{label:e.subject_name,value:e.subject_id}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"年级"}},[a("el-date-picker",{attrs:{type:"year","value-format":"yyyy",placeholder:"选择年级",size:"medium"},on:{change:e.changeLevel},model:{value:e.form.level,callback:function(t){e.$set(e.form,"level",t)},expression:"form.level"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.checkGrade}},[e._v("获取分组")])],1)],1),e._v(" "),e.isGetGroup?a("GroupTable",{attrs:{studentMap:e.studentMap}}):e._e(),e._v(" "),a("el-dialog",{attrs:{title:"以下班级没有上传成绩单，是否确认创建分组？",visible:e.dialogTableVisible},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("el-table",{attrs:{data:e.no_upload_grade_cno}},[a("el-table-column",{attrs:{property:"level",label:"年级"}}),e._v(" "),a("el-table-column",{attrs:{property:"cno",label:"班号"}})],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogTableVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,"0358b9ff",null));t.default=r.exports},en8D:function(e,t,a){"use strict";a("in6O")},in6O:function(e,t,a){},xqZR:function(e,t,a){"use strict";a("bGw+")}}]);
//# sourceMappingURL=4.2e32480a49312a42b140.js.map