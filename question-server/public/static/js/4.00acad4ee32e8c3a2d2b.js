(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"1OIU":function(e,t,a){},OCTE:function(e,t,a){"use strict";a("1OIU")},jb8k:function(e,t,a){"use strict";a.r(t);var s={name:"student",props:["param"],data:function(){return{dialogGrade:!1,tableData:[],exam_detail_id:"",subject_name:"",exam_name:"",exam_id:"",subject_id:"",gradeFileList:[],gradeFileName:"",gradeForm:{class:""},options:[],classMap:{}}},mounted:function(){this.subject_name=this.param.subject_name||"",this.exam_name=this.param.exam_name||"",this.exam_detail_id=this.param.exam_detail_id||"",this.exam_id=this.param.exam_id||"",this.subject_id=this.param.subject_id||"",this.getList(),this.getClassList()},methods:{getList:function(){var e=this;this.$request.fetchSelectGradereport({exam_detail_id:this.exam_detail_id}).then((function(t){e.tableData=t.data})).catch((function(e){console.log(e)}))},upload:function(e,t){var a=this;if(this.gradeForm.class){var s=this.classMap[this.gradeForm.class].level,i=this.classMap[this.gradeForm.class].cno,r=e.file.name.split(".").pop(),l=this.exam_id+"_"+this.subject_id+"_"+s+"_"+i+"_"+t+"."+r;this.gradeFileName=l;var n=new FormData;n.append("files",e.file),n.append("filename",l),this.$request.fetchExamUpload(n).then((function(e){e.IsSuccess&&a.imgList.push(e.Data.Data)}))}else this.$message.error("请先选择班级")},getClassList:function(){var e=this;this.$request.fetchSearchClass({level:"",headteacher:""}).then((function(t){for(var a=t.data.result,s=[],i=function(t){var i=a[t];e.classMap[a[t].id]=a[t];var r=s.find((function(e){return e.value===i.level}));r||(r={value:i.level,label:i.level,children:[]},s.push(r)),r.children.push({value:i.id,label:i.cno})},r=0;r<a.length;r++)i(r);e.options=s})).catch((function(t){console.log(t),e.$message({showClose:!0,message:"班级列表数据获取失败！",type:"error"})}))},submitGradeForm:function(){var e=this;this.gradeFileName?this.$request.fetchCreateGradereport({exam_id:this.exam_id,exam_detail_id:this.exam_detail_id,class_id:this.gradeForm.class,grade_file_path:this.gradeFileName}).then((function(t){if(t.data.result)return e.dialogGrade=!1,e.getList(),void e.$message({showClose:!0,message:"上传成功！",type:"success"});t.data.desc&&e.$message({showClose:!0,message:t.data.desc,type:"error"})})).catch((function(e){console.log(e)})):this.$message.error("成绩单未上传，请上传成绩单")},deleteRow:function(e){var t=this;this.$request.fetchDelGradereport({class_grade_report_id:e.class_grade_report_id}).then((function(e){if(e.data.result)return t.getList(),void t.$message.success("删除成功");e.data.desc&&t.$message.error(e.data.desc)}))},clickUpload:function(){this.dialogGrade=!0,this.gradeForm.class="",this.gradeFileList=[]},handleExceed:function(e){this.$message.warning("您已上传"+e+"，请将已上传的文件删除后重新上传")},handleChange:function(e){this.gradeForm.class=e[1]},back:function(){this.$emit("func",{exam_name:this.param.exam_name,exam_id:this.param.exam_id}),this.$store.dispatch("setExamLevel","subject")}}},i=(a("OCTE"),a("KHd+")),r=Object(i.a)(s,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-button",{attrs:{size:"medium"},on:{click:e.back}},[e._v("返回上一级")]),e._v(" "),a("el-button",{staticClass:"addBtn",attrs:{size:"medium"},on:{click:e.clickUpload}},[e._v("上传成绩单")]),e._v(" "),[a("div",{staticClass:"card"},[a("h1",[e._v(e._s(e.exam_name)+"-"+e._s(e.subject_name)+" 成绩单")])]),e._v(" "),a("el-table",{attrs:{data:e.tableData}},[a("el-table-column",{attrs:{property:"level",label:"年级"}}),e._v(" "),a("el-table-column",{attrs:{property:"cno",label:"班级"}}),e._v(" "),a("el-table-column",{attrs:{property:"header_teacher_name",label:"班主任"}}),e._v(" "),a("el-table-column",{attrs:{property:"grade_file_path",label:"成绩单"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popconfirm",{attrs:{title:"确定删除这个成绩单吗？"},on:{confirm:function(a){return e.deleteRow(t.row)}}},[a("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[e._v("删除")])],1)]}}])})],1)],e._v(" "),a("el-dialog",{attrs:{title:"上传成绩单",visible:e.dialogGrade,width:"347px"},on:{"update:visible":function(t){e.dialogGrade=t}}},[a("el-form",{attrs:{model:e.gradeForm,"label-width":"90px"}},[a("el-form-item",{attrs:{label:"班级"}},[a("el-cascader",{attrs:{options:e.options},on:{change:e.handleChange},model:{value:e.gradeForm.class,callback:function(t){e.$set(e.gradeForm,"class",t)},expression:"gradeForm.class"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"上传成绩单"}},[a("el-upload",{attrs:{action:"","with-credentials":!0,limit:1,"file-list":e.gradeFileList,"http-request":function(t){return e.upload(t,"grade")},"on-exceed":function(){return e.handleExceed("成绩单")}}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("上传成绩单")])],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogAddStu=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitGradeForm()}}},[e._v("确 定")])],1)],1)],2)}),[],!1,null,"649077b0",null);t.default=r.exports}}]);
//# sourceMappingURL=4.00acad4ee32e8c3a2d2b.js.map