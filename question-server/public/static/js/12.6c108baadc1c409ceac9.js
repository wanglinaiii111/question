(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"/+HT":function(e,t,i){"use strict";i("I1WT")},I1WT:function(e,t,i){},aHvB:function(e,t,i){"use strict";i.r(t);var s=i("QbLZ"),a=i.n(s),n={name:"subject",props:["param"],data:function(){return{dialogSubVisible:!1,formAddSub:{subject_id:"1",question_file_path:"",answer_file_path:""},allSubjectList:[],curSubjectList:[],exam_id:"",exam_name:"",fileList:[],answersFileList:[],fileName:"",answersFileName:""}},mounted:function(){this.exam_id=this.param.exam_id||"",this.exam_name=this.param.exam_name||"",this.getList(),this.getSubjectList()},methods:{upload:function(e,t){var i=this,s=e.file.name.split(".").pop(),a=this.formAddSub.exam_id+"_"+this.formAddSub.subject_id+"_"+t+"."+s;"questions"===t?this.fileName=a:"answers"===t?this.answersFileName=a:this.gradeFileName=a;var n=new FormData;n.append("files",e.file),n.append("filename",a),console.log(n),this.$request.fetchExamUpload(n).then((function(e){e.IsSuccess&&i.imgList.push(e.Data.Data)}))},getList:function(){var e=this;this.$request.fetchSelectExamsubject({exam_id:this.exam_id}).then((function(t){e.curSubjectList=t.data})).catch((function(e){console.log(e)}))},getSubjectList:function(){var e=this;this.$request.fetchSelectSubject({}).then((function(t){e.allSubjectList=t.data})).catch((function(e){console.log(e)}))},createSubject:function(){this.dialogSubVisible=!0,this.fileList=[],this.answersFileList=[],this.formAddSub=a()({},this.formAddSub,{exam_id:this.exam_id})},submitAddSubject:function(){var e=this;this.fileName?this.answersFileName?this.$request.fetchCreateExamsubject(a()({},this.formAddSub,{question_file_path:this.fileName,answer_file_path:this.answersFileName})).then((function(t){if(t.data.result)return e.dialogSubVisible=!1,e.getList(),void e.$message({showClose:!0,message:"上传成功！",type:"success"});t.data.desc&&e.$message({showClose:!0,message:t.data.desc,type:"error"})})).catch((function(e){console.log(e)})):this.$message.error("答案未上传，请上传答案"):this.$message.error("试卷未上传，请上传试卷")},showReport:function(e){this.$emit("func",{exam_detail_id:e.exam_detail_id,subject_name:e.subject_name,exam_name:this.exam_name,exam_id:e.exam_id,subject_id:e.subject_id}),this.$store.dispatch("setExamLevel","grade")},handleExceed:function(e){this.$message.warning("您已上传"+e+"，请将已上传的文件删除后重新上传")},changeSubject:function(){this.fileList=[],this.answersFileList=[]},back:function(){this.$store.dispatch("setExamLevel","exam")},showQues:function(e){this.$emit("func",{exam_detail_id:e.exam_detail_id,subject_name:e.subject_name,exam_name:this.exam_name,exam_id:e.exam_id,subject_id:e.subject_id}),this.$store.dispatch("setExamLevel","quesList")}}},l=(i("/+HT"),i("KHd+")),o=Object(l.a)(n,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[[i("el-button",{staticClass:"back",attrs:{size:"medium"},on:{click:e.back}},[e._v("返回上一级")]),e._v(" "),"ordinary"!==e.$store.getters.info.role?i("el-button",{staticClass:"addBtn",attrs:{size:"medium"},on:{click:e.createSubject}},[e._v("添加科目")]):e._e(),e._v(" "),i("div",{staticClass:"card"},[i("h1",[e._v(e._s(e.exam_name))])]),e._v(" "),i("el-table",{attrs:{data:e.curSubjectList}},[i("el-table-column",{attrs:{property:"subject_name",label:"科目名称"}}),e._v(" "),i("el-table-column",{attrs:{property:"question_file_path",label:"试卷文件名"}}),e._v(" "),i("el-table-column",{attrs:{property:"answer_file_path",label:"答案文件名"}}),e._v(" "),i("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{size:"mini"},on:{click:function(i){return e.showReport(t.row)}}},[e._v("查看各班级成绩单")]),e._v(" "),i("el-button",{attrs:{size:"mini"},on:{click:function(i){return e.showQues(t.row)}}},[e._v("查看试题")])]}}])})],1)],e._v(" "),i("el-dialog",{attrs:{title:"添加科目",visible:e.dialogSubVisible,width:"357px"},on:{"update:visible":function(t){e.dialogSubVisible=t}}},[i("el-form",{attrs:{model:e.formAddSub,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"考试科目"}},[i("el-select",{attrs:{size:"medium",placeholder:"请选择考试科目",filterable:""},on:{change:e.changeSubject},model:{value:e.formAddSub.subject_id,callback:function(t){e.$set(e.formAddSub,"subject_id",t)},expression:"formAddSub.subject_id"}},e._l(e.allSubjectList,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e._v(" "),i("el-form-item",{attrs:{label:"上传试卷"}},[i("el-upload",{attrs:{action:"","with-credentials":!0,limit:1,"file-list":e.fileList,"http-request":function(t){return e.upload(t,"questions")},"on-exceed":function(){return e.handleExceed("试卷")}}},[i("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1),e._v(" "),i("el-form-item",{attrs:{label:"上传答案"}},[i("el-upload",{attrs:{action:"","with-credentials":!0,limit:1,"file-list":e.answersFileList,"http-request":function(t){return e.upload(t,"answers")},"on-exceed":function(){return e.handleExceed("答案")}}},[i("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1)],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogSubVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.submitAddSubject}},[e._v("确 定")])],1)],1)],2)}),[],!1,null,"47df7353",null);t.default=o.exports}}]);
//# sourceMappingURL=12.6c108baadc1c409ceac9.js.map