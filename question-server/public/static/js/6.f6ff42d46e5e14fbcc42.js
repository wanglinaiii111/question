(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{ZUAW:function(e,t,a){},bsrR:function(e,t,a){"use strict";a.r(t);var o=a("14Xm"),s=a.n(o),n=a("D3Ub"),r=a.n(n),i={name:"addgroup",data:function(){return{form:{examSub:[],level:(new Date).getFullYear()+"",cno:""},dialogTableVisible:!1,classList:[],no_upload_grade_cno:[],examSubMap:{},options:[]}},mounted:function(){this.getExamList(),this.getClassList()},methods:{getExamList:function(){var e=this;this.$request.fetchSelectExam({}).then((function(t){var a;e.options=[],t.data.result.map((a=r()(s.a.mark((function t(a,o){var n,r;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getExam_subjectList(a.exam_id);case 2:return n=t.sent,r=[],n.map((function(e){r.push({value:e.exam_detail_id,label:e.subject_name})})),e.options.push({value:a.exam_id,label:a.name,children:r}),t.abrupt("return",a);case 7:case"end":return t.stop()}}),t,e)}))),function(e,t){return a.apply(this,arguments)}))})).catch((function(e){console.log(e)}))},getExam_subjectList:function(e){var t=this;return this.$request.fetchSelectExamsubject({exam_id:e}).then((function(e){for(var a=0;a<e.data.length;a++)t.examSubMap[e.data[a].exam_detail_id]=e.data[a].subject_id;return e.data})).catch((function(e){console.log(e)}))},getClassList:function(){var e=this;this.$request.fetchSearchClass({level:this.form.level,headteacher:""}).then((function(t){var a=t.data.result;e.classList=a,a.length>0&&(e.form.cno=a[0].cno)}))},getGroupBtn:function(){if(0===this.form.examSub.length)return this.$message.error("请选择考试科目");this.getGroupList()},getGroupList:function(){var e=this;this.$request.fetchSearchgroup({level:this.form.level,cno:this.form.cno,exam_detail_id:this.examSub[1]}).then((function(t){if(t.data.result.length>0)return e.$confirm("当前考试已获取过分组，请去分组查询页面查看！","提示",{confirmButtonText:"确定",type:"success",showCancelButton:!1});e.checkGrade()}))},checkGrade:function(){var e=this;this.$request.fetchCheckreport({exam_detail_id:this.form.examSub[1]}).then((function(t){if(""===t.data.examid||null===t.data.examid)return e.$message.error("当前年级没有班级上传成绩单");var a=t.data.no_upload_grade_cno;e.dialogTableVisible=!0,e.no_upload_grade_cno=a.map((function(e){return{cno:e,level:t.data.level}}))}))},pushreport:function(){var e=this;this.$request.fetchPushreport({grade_file_name_list:this.getGrade(),exam_detail_id:this.form.examSub[1],subject_id:this.examSubMap[this.form.examSub[1]],level:this.form.level}).then((function(t){"推送成功!"===t.data.desc?e.getGroup():e.$message.error(t.data.desc)}))},getGroup:function(){var e=this;this.$request.fetchGetgroup({examName:this.form.examSub[1]+""}).then((function(t){var a=t.data.data.filter((function(t){return t.class===e.form.cno}));e.saveGroup(a)}))},saveGroup:function(e){var t=this;this.$request.fetchAddgroup({exam_detail_id:this.form.examSub[1],glist:e}).then((function(e){if(!e.data.desc)return t.$confirm("分组获取成功，请去分组查询页面查看！","提示",{confirmButtonText:"确定",type:"success",showCancelButton:!1});t.$message.error(e.data.desc)}))},getGrade:function(){var e={};this.no_upload_grade_cno.map((function(t){return e[t.cno]=t,t}));for(var t=[],a=0;a<this.classList.length;a++)if(!e[this.classList[a].cno]){var o=this.form.examSub[0]+"_"+this.examSubMap[this.form.examSub[1]]+"_"+this.form.level+"_"+this.classList[a].cno+"_grade.xlsx";t.push(o)}return t},confirm:function(){this.dialogTableVisible=!1,this.pushreport()},changeLevel:function(e){this.form.level=e,this.getClassList()},changeExamId:function(e){this.examSub=e}}},l=(a("mFtf"),a("KHd+")),c=Object(l.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"card"},[a("el-form",{ref:"form",staticClass:"myForm",attrs:{model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"年级"}},[a("el-date-picker",{attrs:{type:"year","value-format":"yyyy",placeholder:"选择年级",size:"medium",format:"yyyy届"},on:{change:e.changeLevel},model:{value:e.form.level,callback:function(t){e.$set(e.form,"level",t)},expression:"form.level"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"班号"}},[a("el-select",{model:{value:e.form.cno,callback:function(t){e.$set(e.form,"cno",t)},expression:"form.cno"}},e._l(e.classList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.cno,value:e.cno}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"考试科目"}},[a("el-cascader",{attrs:{options:e.options,"show-all-levels":!0,size:"medium"},on:{change:e.changeExamId},model:{value:e.form.examSub,callback:function(t){e.$set(e.form,"examSub",t)},expression:"form.examSub"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.getGroupBtn}},[e._v("获取分组")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"以下班级没有上传成绩单，是否确认获取分组？",visible:e.dialogTableVisible},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("el-table",{attrs:{data:e.no_upload_grade_cno}},[a("el-table-column",{attrs:{property:"level",label:"年级"}}),e._v(" "),a("el-table-column",{attrs:{property:"cno",label:"班号"}})],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogTableVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,"63cdbf08",null);t.default=c.exports},mFtf:function(e,t,a){"use strict";a("ZUAW")}}]);
//# sourceMappingURL=6.f6ff42d46e5e14fbcc42.js.map