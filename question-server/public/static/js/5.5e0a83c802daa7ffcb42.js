(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{bsrR:function(e,t,a){"use strict";a.r(t);var l={name:"group-table",props:["studentMap","tableData"],data:function(){return{stuMap:{}}},watch:{studentMap:function(e,t){this.stuMap=e}},mounted:function(){},methods:{getTableData:function(e){var t=this;return e.map((function(e){return{sno:e[0],sname:t.stuMap[e[0]]?t.stuMap[e].sname:"",sScore:e[1]}}))},getKnowledgeInfo:function(e){for(var t="",a=0;a<e.length;a++)t+=e[a].weakKnowledge+"_"+e[a].rate,a!=e.length-1&&(t+="||");return t}}},s=(a("nHE2"),a("KHd+")),n={name:"addgroup",components:{GroupTable:Object(s.a)(l,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",e._l(e.tableData,(function(t,l){return a("div",{key:l,staticClass:"groupTable"},[a("h1",[e._v("年级："+e._s(t.grade)+" 班级："+e._s(t.class))]),e._v(" "),a("el-table",{staticStyle:{width:"100%","margin-top":"8px"},attrs:{data:t.classGroup}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.getTableData(t.row.student),border:""}},[a("el-table-column",{attrs:{prop:"sname",label:"学生姓名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"sno",label:"学号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"sScore",label:"学号"}})],1)]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{prop:"groupId",label:"组号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"rank",label:"所属分级"}}),e._v(" "),a("el-table-column",{attrs:{label:"薄弱知识点信息"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("\n            "+e._s(e.getKnowledgeInfo(t.row.weakKnowledgeInfo))+"\n            ")])]}}],null,!0)})],1)],1)})),0)}),[],!1,null,"2fd664c5",null).exports},data:function(){return{form:{exam:"",examSub:"",level:(new Date).getFullYear()+""},dialogTableVisible:!1,examList:[],examsubjectList:[],classList:[],no_upload_grade_cno:[],studentMap:{},tableData:[],isGetGroup:!1,examDetailIdMap:{}}},mounted:function(){this.getExamList(),this.getClassList()},methods:{getExamList:function(){var e=this;this.$request.fetchSelectExam({}).then((function(t){if(e.examList=t.data.result,t.data.result.length>0){var a=t.data.result[0].exam_id;e.getExamSubList(a),e.form.exam=a}})).catch((function(e){console.log(e)}))},getExamSubList:function(e){var t=this;this.$request.fetchSelectExamsubject({exam_id:e}).then((function(e){t.examsubjectList=e.data;for(var a=0;a<e.data.length;a++)t.examDetailIdMap[e.data[a].exam_id+"-"+e.data[a].subject_id]=e.data[a].exam_detail_id;if(e.data.length>0){var l=e.data[0].subject_id;t.form.examSub=l}})).catch((function(e){console.log(e)}))},getClassList:function(){var e=this;this.$request.fetchSearchClass({level:this.form.level,headteacher:""}).then((function(t){e.classList=t.data.result}))},checkGrade:function(){var e=this,t=this.examDetailIdMap[this.form.exam+"-"+this.form.examSub];this.getStudentList(),this.$request.fetchCheckreport({exam_detail_id:t}).then((function(t){if(""===t.data.examid||null===t.data.examid)return e.$message.error("当前年级没有班级上传成绩单");var a=t.data.no_upload_grade_cno;e.dialogTableVisible=!0,e.no_upload_grade_cno=a.map((function(e){return{cno:e,level:t.data.level}})),console.log(e.no_upload_grade_cno)}))},pushreport:function(){var e=this,t=this.examDetailIdMap[this.form.exam+"-"+this.form.examSub];this.$request.fetchPushreport({grade_file_name_list:this.getGrade(),exam_detail_id:t,subject_id:this.form.examSub,level:this.form.level}).then((function(t){"推送成功!"===t.data.desc||e.$message.error(t.data.desc)}))},getGroup:function(){var e=this,t=this.examDetailIdMap[this.form.exam+"-"+this.form.examSub];this.$request.fetchGetgroup({examName:t+""}).then((function(t){e.isGetGroup=!0,e.tableData=t.data.data,e.saveGroup(t.data.data)}))},saveGroup:function(e){var t=this,a=this.examDetailIdMap[this.form.exam+"-"+this.form.examSub];this.$request.fetchAddgroup({exam_detail_id:a,glist:e}).then((function(e){e.data.desc?t.$message.error(e.data.desc):t.$message.success("获取成功")}))},getGrade:function(){var e={};this.no_upload_grade_cno.map((function(t){return e[t.cno]=t,t}));for(var t=[],a=0;a<this.classList.length;a++)if(!e[this.classList[a].cno]){var l=this.form.exam+"_"+this.form.examSub+"_"+this.form.level+"_"+this.classList[a].cno+"_grade.xlsx";t.push(l)}return t},getStudentList:function(){var e=this;this.$request.fetchSearchStu({level:this.form.level,cno:""}).then((function(t){for(var a=t.data.result,l={},s=0;s<a.length;s++)l[a[s].sno]=a[s];e.studentMap=l})).catch((function(e){console.log(e)}))},confirm:function(){this.dialogTableVisible=!1,this.pushreport(),this.getGroup()},changeLevel:function(e){this.form.level=e,this.getClassList()},changeExam:function(e){this.form.exam=e,this.getExamSubList(e)}}},o=(a("tUH1"),Object(s.a)(n,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"card"},[a("el-form",{ref:"form",staticClass:"myForm",attrs:{model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"考试名称",size:"medium"}},[a("el-select",{model:{value:e.form.exam,callback:function(t){e.$set(e.form,"exam",t)},expression:"form.exam"}},e._l(e.examList,(function(t){return a("el-option",{key:t.exam_id,attrs:{label:t.name,value:t.exam_id},on:{change:e.changeExam}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"科目名称",size:"medium"}},[a("el-select",{model:{value:e.form.examSub,callback:function(t){e.$set(e.form,"examSub",t)},expression:"form.examSub"}},e._l(e.examsubjectList,(function(e){return a("el-option",{key:e.subject_id,attrs:{label:e.subject_name,value:e.subject_id}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"年级"}},[a("el-date-picker",{attrs:{type:"year","value-format":"yyyy",placeholder:"选择年级",size:"medium"},on:{change:e.changeLevel},model:{value:e.form.level,callback:function(t){e.$set(e.form,"level",t)},expression:"form.level"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.checkGrade}},[e._v("获取分组")])],1)],1),e._v(" "),e.isGetGroup?a("GroupTable",{attrs:{studentMap:e.studentMap,tableData:e.tableData}}):e._e(),e._v(" "),a("el-dialog",{attrs:{title:"以下班级没有上传成绩单，是否确认获取分组？",visible:e.dialogTableVisible},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("el-table",{attrs:{data:e.no_upload_grade_cno}},[a("el-table-column",{attrs:{property:"level",label:"年级"}}),e._v(" "),a("el-table-column",{attrs:{property:"cno",label:"班号"}})],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogTableVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,"f7ea57f8",null));t.default=o.exports},nHE2:function(e,t,a){"use strict";a("vgEQ")},tUH1:function(e,t,a){"use strict";a("vWuV")},vWuV:function(e,t,a){},vgEQ:function(e,t,a){}}]);
//# sourceMappingURL=5.5e0a83c802daa7ffcb42.js.map